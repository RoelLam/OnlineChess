<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/iron-image/iron-image.html">



<dom-module id="schaakbord-element">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
	<div>
		<center>
			<div id="poging2" style="height:{{height}}px;"><iron-image id="schaakbord" style="height:{{height}}px; width:{{width}}px;"sizing="contain" src="/Bord/Chess_Board.png"></iron-image></div>
			<content></content>
		</center>
	</div>
	<div id="send">
		<iron-ajax id="zet" url="http://localhost:8080/zetten/zet/" on-response="handleZet" handle-as="text" type="text"></iron-ajax>
	</div>
  </template>

  <script>
	var iets = 0.75*window.screen.availHeight;
	var select = false;
	var schaakstukId; var startField; var endField; 
	var xcoord; var ycoord;
	var selectedElement;
    Polymer({
      is: 'schaakbord-element',

      properties: {
        width: {
          type: String,
          value: iets,
		  readOnly: true,
		  notify: true
        },
		height: {
          type: String,
          value: iets,
		  readOnly: true,
		  notify: true
        },
	  },	 
		 
	  listeners: {
		'tap':'selectPiece'
	  },
	  
	  handleZet: function(e){
		var resp = e.detail.response;
		if(resp=="true"){
			var iconName = document.getElementById(schaakstukId).getAttribute('icon');
			var typeColor = iconName.substr(17,iconName.length - 1); 
			typeColor = typeColor.split("_");
			document.getElementById(startField).innerHTML="";
			toonStuk(typeColor[0],typeColor[1],schaakstukId,xcoord,ycoord);
		}	  
	  },
	  
	  selectPiece: function(e){
		
		if(!select){
			if(e.target.className !="veld"){
				console.log(e);
				schaakstukId = e.target.id;
				selectedElement = e.target.parentElement;
				selectedElement.className += ' achtergrondKleur';
				select = !select;
				startField = e.target.parentNode.id; 
			}
		}else{
			if(e.target.className !="veld"){
				endField = e.target.parentNode.id;
			}else {
				endField = e.target.id;
			}
			
			select = !select;
			
			xcoord = endField.charAt(3);
			ycoord = endField.charAt(4);
			
			this.$.zet.url="http://localhost:8080/zetten/zet/" + schaakstukId + "/" + xcoord + "/" + ycoord;
			this.$.zet.generateRequest();
			console.log(e.target.parentElement.className.replace(' achtergrondKleur',''));
			if(selectedElement){
				selectedElement.className = 'veld';
			}
		}		
		
	 },
		
    });
  </script>
  
</dom-module>